# Tips & Tricks

## Disable Template Cache

Add following code in your config.php to disable the Template Cache

```php
'template' => [
    'forceCompile' => true,
],
```

## Have you had a chance to answer the previous question?

Yes, after a few months we finally found the answer. Sadly, Mike is on vacations right now so I'm afraid we are not able to provide the answer at this point.

## Article names are escaped after Shop Migration

SwagMigration does escape all product anmes. It can be solved with a simple SQL

```sql
UPDATE s_articles SET name = REPLACE(name, "&amp;", "&");
UPDATE s_articles SET name = REPLACE(name, "&lt;", "<");
UPDATE s_articles SET name = REPLACE(name, "&gt;", ">");
```

## Configure SMTP in config.php

```php
'mail' => [
    'type'     => 'smtp', // Possible values: 'mail', 'smtp', 'file'
    'host'     => 'localhost',
    'port'     => 587,
    'ssl'      => 'tls', // Possible values: '', 'tls', 'ssl'
    'auth'     => 'login',  // Possible values: 'plain', 'login', 'crammd5'
    'username' => 'me@localhost',
    'password' => 'mypassword'
],
```

## Add a Smarty Plugin folder with a Plugin

It can be solved with a simple CompilerPass in your Plugin

{% code-tabs %}
{% code-tabs-item title="MyPlugin/Components/CompilerPass/AddTemplatePluginDirCompilerPass.php" %}
```php
<?php

namespace MyPlugin\Components\CompilerPass;

use Symfony\Component\DependencyInjection\Compiler\CompilerPassInterface;
use Symfony\Component\DependencyInjection\ContainerBuilder;

class AddTemplatePluginDirCompilerPass implements CompilerPassInterface
{
    public function process(ContainerBuilder $container)
    {
        $template = $container->getDefinition('template');
        $template->addMethodCall('addPluginsDir', [$container->getParameter('my_plugin.my_parameter_to_folder')]);
    }
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

{% code-tabs %}
{% code-tabs-item title="MyPlugin.php" %}
```php
<?php

class MyPlugin extends Plugin
{
    public function build(ContainerBuilder $container)
    {
        parent::build($container);
        $container->addCompilerPass(new AddTemplatePluginDirCompilerPass());
    }
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

## Emotion Element with static combobox values

You can't pass store values in to a combobox in an emotion element. This guide will show you how to create a custom extjs store with static values.

{% code-tabs %}
{% code-tabs-item title="Test.php" %}
```php
<?php

namespace Test;
use Shopware\Components\Plugin;
use Shopware\Components\Plugin\Context\InstallContext;

class Test extends Plugin
{
    public static function getSubscribedEvents()
    {
        return [
            'Enlight_Controller_Action_PostDispatch_Backend_Emotion' => 'onPostDispatchEmotion'
        ];
    }
    
    public function onPostDispatchEmotion(\Enlight_Event_EventArgs $args)
    {
        /** @var \Shopware_Controllers_Backend_Emotion $subject */
        $subject = $args->getSubject();
        if ($subject->Request()->getActionName() == 'index') {
            $subject->View()->addTemplateDir($this->getPath() . '/Resources/views');
            $subject->View()->extendsTemplate('emotionstore.js');
        }
    }
    
    public function install(InstallContext $context)
    {
        parent::install($context); // TODO: Change the autogenerated stub
        $emotion = $this->container->get('shopware.emotion_component_installer');
        $vimeoElement = $emotion->createOrUpdate(
            $this->getName(),
            'Vimeo Video',
            [
                'name' => 'Vimeo Video',
                'template' => 'emotion_vimeo',
                'cls' => 'emotion-vimeo-element',
                'description' => 'A simple vimeo video element for the shopping worlds.'
            ]
        );
        $vimeoElement->createComboBoxField([
            'fieldLabel' => 'Test',
            'name' => 'bla',
            'supportText' => 'yay',
            'allowBlank' => false,
            'store' => 'Shopware.apps.Emotion.store.MyTestStore',
            'queryMode' => 'local',
            'displayField' => 'name',
            'valueField' => 'id'
        ]);
    }
}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

{% code-tabs %}
{% code-tabs-item title="Resources/views/emotionstore.js" %}
```javascript
//{block name="backend/Emotion/app" append}
Ext.define('Shopware.apps.Emotion.store.MyTestStore', {
    extend: 'Ext.data.Store',
    fields: [
        {
            name: 'id',
            type: 'integer'
        },
        {
            name: 'name',
            type: 'string'
        }
    ],
    data: [
        {
            id: 1,
            name: "LOL"
        },
        {
            id: 2,
            name: "Test"
        }
    ]
})
//{/block}
```
{% endcode-tabs-item %}
{% endcode-tabs %}

## Assign the snippet value to a variable

```markup
{s name="NameFromSnippet" assign="tplVariable"}Default Value{/s}
{$tplVariable|replace:'Test':'Lol'}
```

## Inject Plugin Configuration

This method loads only configuration from main shop.

```markup
<service id="myplugin.config" class="Shopware\Components\Plugin\CachedConfigReader">
    <factory service="shopware.plugin.cached_config_reader" method="getByPluginName"/>
    <argument type="string">MyPlugin</argument>
</service>
```

Since Shopware 5.5.3 it's possible to fetch also the right config translation

```markup
<service id="myplugin.config" class="Shopware\Components\Plugin\CachedConfigReader">
    <factory service="shopware.plugin.cached_config_reader" method="getByPluginName"/>
    <argument type="string">MyPlugin</argument>
    <argument type="expression">container.initialized('shop') ? service('shop') : null</argument>
</service>
```

## Use composer with the release zip version

The dev autoload files are not existing in release zip. So you have to execute all commands with --no-dev

## Force loading of plugins in old system

Sometimes you want use Components of Plugins which are writing in old plugin system and the autoloading does not work. This problem occurs cause the plugins are lazy and constructed only if needed. You can force construction with the following code

```php
Shopware()->Plugins()->Namespace()->PluginName()
// e.g Shopware()->Plugins()->Backend()->HttpCache()
```

## Disable http-cache in Subscriber/Controller

With setting a Cache-Control header you can disable for the current request the http-cache.

```php
$this->Response()->setHeader('Cache-Control', 'private', true);

```

## How is the shipping calculation when the user is not logged in?

Shopware uses here the country with the lowest position to calculate the shipping costs

